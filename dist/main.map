{"version":3,"sources":["ECS/entity.js","ECS/component.js","ECS/system.js","ECS/utils.js","ECS/manager.js","ECS/index.js","main.js"],"names":["Entity","constructor","id","components","setID","addComponent","component","unique","some","c","name","console","warn","push","removeComponents","componentName","predicate","filter","state","hasComponent","getComponents","map","Component","Name","Value","value","Level","level","exp","Equippable","slot","Attributes","health","Attacking","target","System","attack","entities","mapIf","e","forEach","t","checkDead","entity","EntityList","Array","fn","shortid","generate","Manager","entityCount","systems","addEntity","reduce","removeEntity","getEntities","updateEntities","addSystem","system","runSystems","s","PORT","process","env","server","listen","socket","WebSocket","clients","on","ws","payload","log","man","ECS","find","i","dir","depth"],"mappings":"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","file":"main.map","sourceRoot":"../src","sourcesContent":["export class Entity {\n  constructor() {\n    this.id = null;\n    this.components = [];\n  }\n\n  setID(id = \"\") {\n    this.id = id;\n\n    return this;\n  }\n\n  addComponent(component) {\n    if (!component.unique) this.components.push(component);\n    else if (!this.components.some(c => c.name === component.name))\n      this.components.push(component);\n    else\n      console.warn(\n        `Attempting to add non-unique component \"${component.name}\" to \"${\n          this.id\n        }\" when that component already exists!`\n      );\n\n    return this;\n  }\n\n  removeComponents(componentName, predicate) {\n    this.components = this.components.filter(\n      c => !(c.name === componentName && predicate(c.state))\n    );\n\n    return this;\n  }\n\n  hasComponent(componentName) {\n    return this.components.some(c => c.name === componentName);\n  }\n\n  getComponents(componentName) {\n    return this.components\n      .filter(c => c.name === componentName)\n      .map(c => c.state);\n  }\n}\n","export const Component = {\n  /** Simple name component, this allows things to be identified in the game\n   *  world. Most things should have a name.\n   */\n  Name: (name = \"\") => ({\n    name: \"name\",\n    unique: true,\n    state: name\n  }),\n  /** Entities have the Value component when they can be sold to a vendor or\n   *  traded between players. The component describes how much gold the entity\n   *  is worth, before taking into account any modifiers.\n   */\n  Value: (value = 0) => ({\n    name: \"value\",\n    unique: true,\n    state: value\n  }),\n  /** The Level component is for entities such as players and enemies that can\n   *  earn experience, or otherwise have their functionality affected by their\n   *  level.\n   */\n  Level: (level = 1, exp = 0) => ({\n    name: \"level\",\n    unique: true,\n    state: {\n      level,\n      exp\n    }\n  }),\n  /**\n   *\n   */\n  Equippable: slot => ({\n    name: \"equippable\",\n    unique: true,\n    state: {\n      slot\n    }\n  }),\n  /**\n   *\n   */\n  Attributes: (health = 100) => ({\n    name: \"attributes\",\n    unique: true,\n    state: {\n      health\n    }\n  }),\n  /**\n   *\n   */\n  Attacking: target => ({\n    name: \"attacking\",\n    unique: false,\n    state: target\n  })\n};\n","export const System = {\n  attack: entities => {\n    return entities.mapIf(\n      e => e.hasComponent(\"attacking\"),\n      e => {\n        e.getComponents(\"attacking\").forEach(target =>\n          entities.mapIf(\n            t => t.id === target,\n            t => {\n              t.getComponents(\"attributes\")[0].health -= e.getComponents(\n                \"level\"\n              )[0].level;\n\n              return t;\n            }\n          )\n        );\n\n        return e;\n      }\n    );\n  },\n\n  checkDead: entities => {\n    return entities.mapIf(\n      e =>\n        e.hasComponent(\"attributes\") &&\n        e.getComponents(\"attributes\")[0].health <= 0,\n      entity => {\n        entity.removeComponents(\"attacking\", c => true);\n        entities.mapIf(\n          e => e.hasComponent(\"attacking\"),\n          e => e.removeComponents(\"attacking\", c => c === entity.id)\n        );\n\n        return entity;\n      }\n    );\n  }\n};\n","import shortid from \"shortid\";\n\nexport class EntityList extends Array {\n  mapIf(predicate, fn) {\n    return this.map(entity => (predicate(entity) ? fn(entity) : entity));\n  }\n\n  push(entity) {\n    super.push(entity.setID(shortid.generate()));\n\n    return this;\n  }\n}\n","import { Entity } from \"./entity\";\nimport { EntityList } from \"./utils\";\n\nexport class Manager {\n  constructor() {\n    this.entityCount = 0;\n    this.entities = new EntityList();\n    this.systems = [];\n\n    return this;\n  }\n\n  addEntity(components = []) {\n    this.entities.push(\n      components.reduce((e, c) => e.addComponent(c), new Entity())\n    );\n\n    return this;\n  }\n\n  removeEntity(id) {\n    this.entities = this.entities.filter(e => e.id !== id);\n\n    return this;\n  }\n\n  getEntities() {\n    return this.entities;\n  }\n\n  updateEntities(predicate, fn) {\n    this.entities = this.entities.mapIf(predicate, fn);\n\n    return this;\n  }\n\n  addSystem(system) {\n    this.systems.push(system);\n\n    return this;\n  }\n\n  runSystems() {\n    this.entities = this.systems.reduce((e, s) => (e = s(e)), this.entities);\n\n    return this;\n  }\n}\n","import { Entity } from \"./entity\";\nimport { Component } from \"./component\";\nimport { System } from \"./system\";\nimport { Manager } from \"./manager\";\n\nimport { EntityList } from \"./utils\";\n\nexport default {\n  Entity,\n  Component,\n  System,\n  Manager\n};\n","import express from \"express\";\nimport lowdb from \"lowdb\";\nimport { Server as WebSocket } from \"ws\";\n\n// Constants -------------------------------------------------------------------\nconst PORT = process.env.PORT || 3000;\n\n// Express Server --------------------------------------------------------------\nconst server = express().listen(PORT, () => {});\n\n// Web Socket ------------------------------------------------------------------\nconst socket = new WebSocket({ server });\nconst clients = {};\n\nsocket.on(\"connection\", ws => {\n  ws.on(\"message\", payload => {\n    console.log(payload);\n  });\n\n  ws.on(\"close\", () => {});\n});\n\nimport ECS from \"./ECS\";\nconst man = new ECS.Manager();\nman\n  .addEntity([\n    ECS.Component.Name(\"andy\"),\n    ECS.Component.Attributes(),\n    ECS.Component.Level()\n  ])\n  .addEntity([\n    ECS.Component.Name(\"alex\"),\n    ECS.Component.Attributes(150),\n    ECS.Component.Level(),\n    ECS.Component.Attacking(\n      man.getEntities().find(e => e.getComponents(\"name\")[0] === \"andy\").id\n    )\n  ])\n  .updateEntities(\n    e => e.hasComponent(\"name\") && e.getComponents(\"name\")[0] === \"andy\",\n    e =>\n      e.addComponent(\n        ECS.Component.Attacking(\n          man.getEntities().find(e => e.getComponents(\"name\")[0] === \"alex\").id\n        )\n      )\n  )\n  .addSystem(ECS.System.attack)\n  .addSystem(ECS.System.checkDead);\n\nfor (let i = 0; i <= 200; i++) {\n  man.runSystems();\n}\n\nconsole.dir(man, { depth: null });\n"]}